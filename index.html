<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‰∏≠ÊñáË≠òÂ≠óÈÄö</title> <script src="https://cdn.jsdelivr.net/npm/hanzi-writer@3.5/dist/hanzi-writer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/cnchar/cnchar.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/cnchar-trad/cnchar.trad.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/cnchar-radical/cnchar.radical.min.js"></script>

<style>
    :root {
        --primary: #1976d2;
        --primary-bg: #e3f2fd;
        --accent: #d84315;
        --success: #4caf50;
        --text-main: #333;
        --bg-body: #f4f7f6;
        --bg-white: #ffffff;
        --radius-box: 20px;
        --grid-size: 260px;
    }

    body {
        font-family: "ÂæÆËªüÊ≠£ÈªëÈ´î", sans-serif;
        background-color: var(--bg-body);
        color: var(--text-main);
        margin: 0; padding: 20px; text-align: center;
        transition: background-color 0.3s;
    }

    h1 { color: var(--primary); letter-spacing: 2px; margin-bottom: 30px; }

    /* Â∑•ÂÖ∑Âàó */
    .toolbar {
        position: sticky; top: 0; z-index: 100;
        background: rgba(244, 247, 246, 0.95); padding: 10px;
        display: flex; justify-content: center; gap: 15px;
        backdrop-filter: blur(5px); border-bottom: 1px solid #ddd;
        flex-wrap: wrap;
    }
    .tool-btn {
        padding: 8px 20px; border-radius: 20px; border: 2px solid var(--primary);
        background: white; color: var(--primary); font-weight: bold; cursor: pointer;
        transition: all 0.2s;
    }
    .tool-btn:hover { background: var(--primary-bg); transform: translateY(-2px); }
    .tool-btn.active-mode {
        background: var(--primary); color: white; box-shadow: inset 0 2px 5px rgba(0,0,0,0.2);
    }

    /* Ëº∏ÂÖ•ÂçÄ */
    .input-section {
        background: var(--bg-white); padding: 30px; border-radius: var(--radius-box);
        box-shadow: 0 10px 25px rgba(0,0,0,0.1); display: inline-block;
        margin: 30px 0; border-top: 6px solid var(--primary);
    }
    input[type="text"] {
        font-size: 28px; padding: 10px; width: 300px;
        border: 2px solid #bdc3c7; border-radius: 10px; text-align: center;
    }
    button.main-btn {
        font-size: 24px; padding: 10px 30px; margin-left: 10px;
        background-color: var(--primary); color: white; border: none;
        border-radius: 10px; cursor: pointer; box-shadow: 0 4px 0 #0d47a1;
    }
    button.main-btn:active { transform: translateY(4px); box-shadow: none; }

    /* Âç°ÁâáÂÆπÂô® */
    #characters-container { 
        display: flex; flex-direction: column; align-items: center; gap: 40px; 
        transition: all 0.3s;
    }
    
    .word-group-wrapper {
        background: var(--bg-white); width: 95%; max-width: 1400px; padding: 30px;
        border-radius: var(--radius-box); box-shadow: 0 10px 30px rgba(0,0,0,0.05);
        text-align: left; animation: fadeInUp 0.5s ease-out;
    }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

    .word-group-header {
        display: flex; justify-content: space-between; align-items: center;
        border-bottom: 2px dashed #eee; padding-bottom: 15px; margin-bottom: 20px;
    }
    
    .title-block { display: flex; align-items: center; gap: 15px; flex-wrap: wrap; }
    .word-label-small { font-size: 20px; color: #666; font-weight: bold; margin-right: 5px; }
    .word-title { font-size: 56px; font-weight: bold; color: var(--primary); line-height: 1.2; }
    
    /* Ë©ûË™ûÁ¥öÂ§ßÊ®ôÁ±§ */
    .word-pos-tag {
        font-size: 20px; padding: 6px 15px; border-radius: 20px;
        color: white; font-weight: bold; background-color: #607d8b;
        box-shadow: 0 4px 10px rgba(0,0,0,0.2); vertical-align: middle;
        margin-left: 10px;
    }
    .word-pos-tag.noun { background-color: #1976d2; }
    .word-pos-tag.verb { background-color: #388e3c; }
    .word-pos-tag.adj { background-color: #f57c00; }

    .audio-controls button {
        background: var(--primary-bg); color: var(--primary); border: none;
        padding: 8px 16px; border-radius: 20px; font-weight: bold; cursor: pointer; margin-left: 10px;
    }

    .word-main-flex { display: flex; gap: 40px; flex-wrap: wrap; }
    .word-visual-left { flex: 3; min-width: 350px; }
    .word-info-right { flex: 1; min-width: 250px; background: #fff8e1; padding: 20px; border-radius: var(--radius-box); }

    .single-char-section {
        background: #f8f9fa; border-radius: 15px; padding: 20px; margin-bottom: 20px; border: 1px solid #eee;
    }
    .char-main-row { display: flex; justify-content: center; gap: 40px; flex-wrap: wrap; }
    .char-block-item { display: flex; flex-direction: column; align-items: center; }
    .visual-label { font-size: 20px; font-weight: bold; color: #555; margin-bottom: 15px; width: 100%; border-left: 6px solid var(--primary); padding-left: 10px; }

    .grid-box {
        width: var(--grid-size); height: var(--grid-size);
        border: 4px solid var(--primary); background-color: white;
        background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiPjxsaW5lIHgxPSI1MCUiIHkxPSIwIiB4Mj0iNTAlIiB5Mj0iMTAwJSIgc3Ryb2tlPSIjZmZjY2NjIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1kYXNoYXJyYXk9IjgsOCIvPjxsaW5lIHgxPSIwIiB5MT0iNTAlIiB4Mj0iMTAwJSIgeTI9IjUwJSIgc3Ryb2tlPSIjZmZjY2NjIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1kYXNoYXJyYXk9IjgsOCIvPjwvc3ZnPg==");
        background-size: 100% 100%; margin-bottom: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    @media (max-width: 768px) { :root { --grid-size: 160px; } }

    .breakdown-section { background: white; padding: 15px; border-radius: 10px; border: 1px solid #ddd; margin-top: 15px; }
    .breakdown-grid { display: flex; flex-wrap: wrap; gap: 8px; }
    .step-box {
        width: 60px; height: 60px; border: 1px solid #ccc; border-radius: 5px; position: relative; background: white;
        display: flex; justify-content: center; align-items: center;
    }
    .step-box svg { width: 100%; height: 100%; display: block; }
    .step-box path { stroke: none; }
    .step-number { position: absolute; bottom: 2px; right: 2px; font-size: 10px; color: #999; }
    .step-box.is-last { border: 2px solid var(--accent); }

    .info-item { margin-bottom: 15px; border-bottom: 1px solid #ffe0b2; padding-bottom: 10px; }
    .info-big-char { font-size: 40px; color: var(--accent); font-weight: bold; font-family: "Ê®ôÊ•∑È´î"; }
    .info-radical-link { color: var(--accent); text-decoration: underline; cursor: pointer; font-weight: bold; }
    .info-row { margin-bottom: 5px; font-size: 18px; color: #444; }

    .pos-container { display: flex; gap: 5px; flex-wrap: wrap; margin-top: 5px; }
    .pos-tag {
        font-size: 14px; padding: 2px 8px; border-radius: 12px;
        color: white; font-weight: bold; background-color: #78909c; box-shadow: 0 2px 0 rgba(0,0,0,0.1);
    }
    .pos-tag.noun { background-color: #42a5f5; } 
    .pos-tag.verb { background-color: #66bb6a; } 
    .pos-tag.adj { background-color: #ffa726; }  

    .js-def-text { white-space: pre-wrap; line-height: 1.8; text-align: left; color: #444; font-size: 18px; }

    .modal-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.5); z-index: 200; display: none;
        justify-content: center; align-items: center; backdrop-filter: blur(3px);
    }
    .modal-overlay.open { display: flex; }
    .modal-content {
        background: white; width: 80%; max-width: 600px; padding: 30px;
        border-radius: 20px; border: 5px solid #ffccbc; position: relative;
    }
    .modal-close { position: absolute; top: 10px; right: 15px; font-size: 30px; cursor: pointer; }
    .radical-grid { display: flex; flex-wrap: wrap; gap: 15px; justify-content: center; margin-top: 20px; }
    .radical-char-btn {
        width: 60px; height: 60px; font-size: 30px; border: 1px solid #ddd;
        display: flex; align-items: center; justify-content: center; cursor: pointer;
        background: #fff3e0; border-radius: 10px; font-family: "Ê®ôÊ•∑È´î";
    }

    /* ÂÖ®Ë¶ΩÊ®°Âºè */
    body.overview-mode #characters-container { flex-direction: row; flex-wrap: wrap; justify-content: center; align-items: stretch; }
    body.overview-mode .word-group-wrapper { width: 45%; min-width: 300px; margin: 10px; border-top: 8px solid var(--primary); }
    body.overview-mode .word-main-flex { display: none !important; }
    body.overview-mode .word-group-header { border-bottom: none; margin-bottom: 5px; }
    body.overview-mode .word-definition-footer { border-top: 1px solid #eee; padding-top: 15px; margin-top: 0; }

    /* ÂàóÂç∞Ê®£Âºè */
    #print-container { display: none; }
    @media print {
        @page { size: A4; margin: 10mm; }
        body { background: white; -webkit-print-color-adjust: exact; padding: 0; }
        #screen-ui, .toolbar, .modal-overlay { display: none !important; }
        #print-container { display: block !important; }
        
        .print-page-header { text-align: center; border-bottom: 2px solid black; margin-bottom: 20px; padding-bottom: 10px; }
        .print-row { display: flex; flex-direction: column; margin-bottom: 25px; border-bottom: 1px dashed #ccc; padding-bottom: 15px; page-break-inside: avoid; }
        .print-main-line { display: flex; align-items: center; margin-bottom: 10px; }
        .print-info-col { display: flex; flex-wrap: wrap; gap: 10px; padding-right: 15px; border-right: 2px solid #000; margin-right: 15px; width: 150px; justify-content: center; align-content: center; }
        .print-char-block { text-align: center; margin-bottom: 5px; } 
        .print-char-big { font-size: 56px; font-family: "Ê®ôÊ•∑È´î"; font-weight: bold; line-height: 1; }
        .print-pinyin { display: none; }
        .print-grid-container { flex: 1; display: flex; gap: 5px; }
        .print-grid-box {
            width: 70px; height: 70px; border: 1px solid #000;
            background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPSc3MCcgaGVpZ2h0PSc3MCc+CiAgPGxpbmUgeDE9JzAnIHkxPSczNScgeDI9JzcwJyB5Mj0nMzUnIHN0cm9rZT0nI2NjYycgc3Ryb2tlLXdpZHRoPScwLjUnIHN0cm9rZS1kYXNoYXJyYXk9JzMsMycvPgogIDxsaW5lIHgxPSczNScgeTE9JzAnIHgyPSczNScgeTI9JzcwJyBzdHJva2U9JyNjY2MnIHN0cm9rZS13aWR0aD0nMC41JyBzdHJva2UtZGFzaGFycmF5PSczLDMnLz4KPC9zdmc+");
        }
        .print-breakdown-area { margin-left: 20px; }
        .print-breakdown-row { display: flex; align-items: center; margin-top: 8px; border-bottom: 1px dotted #eee; padding-bottom: 5px; }
        .print-label { font-size: 16px; font-weight: bold; color: #000; width: 40px; flex-shrink: 0; }
        .print-breakdown-imgs { display: flex; flex-wrap: wrap; gap: 5px; }
        .print-step-box { width: 35px; height: 35px; border: 1px solid #ccc; position: relative; }
    }
</style>
</head>
<body>

    <div id="screen-ui">
        <div class="toolbar">
            <button class="tool-btn" onclick="toggleOverviewMode()" id="btn-overview">üëÅÔ∏è ÂÖ®Ë¶ΩÊ®°ÂºèÔºöÈóú</button>
            <button class="tool-btn" onclick="autoPrint()">üñ®Ô∏è ÂàóÂç∞‰ΩúÊ•≠Á¥ô (Ë©ûË™ûÂêà‰Ωµ)</button>
        </div>

        <h1>üìò ‰∏≠ÊñáË≠òÂ≠óÈÄö</h1> <div class="input-section">
            <label style="font-size: 20px; font-weight: bold; color: var(--primary);">Ë´ãËº∏ÂÖ•ÁîüÂ≠óÊàñË©ûË™û</label><br><br>
            <input type="text" id="input-text" placeholder="‰æãÂ¶ÇÔºöÂ≠∏Ê†°" value="Â≠∏Ê†°">
            <button class="main-btn" onclick="generateCards()">üîç ÈñãÂßãÁ∑¥Áøí</button>
            <div id="loading" style="display:none; margin-top:10px; color:#1976d2;">‚è≥ Ë≥áÊñôËôïÁêÜ‰∏≠...</div>
        </div>

        <div id="characters-container"></div>
    </div>

    <div id="radical-modal" class="modal-overlay" onclick="closeRadicalModal(event)">
        <div class="modal-content">
            <span class="modal-close" onclick="closeRadicalModal(null, true)">√ó</span>
            <h2 style="color:var(--accent)">üîç ÈÉ®È¶ñÂ≠ó‰æãÔºö<span id="modal-radical-title"></span></h2>
            <div id="modal-grid" class="radical-grid"></div>
        </div>
    </div>

    <div id="print-container">
        <div class="print-page-header">
            <h2>‰∏≠ÊñáÁßëÂØ´Â≠óÁ∑¥Áøí</h2>
            <div style="display:flex; justify-content:space-between; padding:0 50px;">
                <span>ÂßìÂêçÔºö__________</span><span>Êó•ÊúüÔºö__________</span><span>ÂàÜÊï∏Ôºö__________</span>
            </div>
        </div>
        <div id="print-content"></div>
    </div>

    <template id="card-template">
        <div class="word-group-wrapper">
            <div class="word-group-header">
                <div class="title-block">
                    <span class="word-label-small">Ë©ûË™ûÔºö</span>
                    <span class="word-title js-title"></span>
                    <div class="js-word-pos"></div> 
                </div>
                <div class="audio-controls">
                    <button class="js-btn-mandarin">üîä ÊôÆÈÄöË©±</button>
                    <button class="js-btn-cantonese">üîä Á≤µË™û</button>
                </div>
            </div>
            <div class="word-main-flex">
                <div class="word-visual-left js-visual-container"></div>
                <div class="word-info-right js-info-container"></div>
            </div>
            <div class="word-definition-footer" style="margin-top:20px; border-top:1px dashed #ccc; padding-top:10px;">
                <div style="font-weight:bold; color:var(--success)">üìñ Ëß£Èáã</div>
                <div class="js-def-text"></div>
            </div>
        </div>
    </template>

    <template id="char-block-template">
        <div class="single-char-section">
            <div class="char-main-row">
                <div class="char-block-item">
                    <div class="visual-label">üëÄ Á≠ÜÈ†ÜÊºîÁ§∫</div>
                    <div class="grid-box js-demo-target"></div>
                    <button class="tool-btn js-play-btn" style="padding: 2px 10px; font-size: 14px;">‚ñ∂ Êí≠Êîæ</button>
                </div>
                <div class="char-block-item">
                    <div class="visual-label label-quiz">‚úèÔ∏è Â≠∏ÁîüÁ∑¥Áøí</div>
                    <div class="grid-box js-quiz-target" style="cursor:crosshair"></div>
                    <span class="js-status-text" style="font-weight:bold; color:var(--accent)">Ë´ãÂØ´Â≠ó</span>
                    <button class="tool-btn js-reset-btn" style="padding: 2px 10px; font-size: 14px;">ÈáçÂØ´</button>
                </div>
            </div>
            <div class="breakdown-section">
                <div class="visual-label" style="border-color: var(--accent);">üî¢ Á≠ÜÁï´ÊãÜËß£ (Á¥ÖËâ≤ÁÇ∫Áï∂ÂâçÁ≠ÜÁï´)</div>
                <div class="breakdown-grid js-breakdown-target">
                    <span style="color:#aaa; font-size:12px;">ËÆÄÂèñ‰∏≠...</span>
                </div>
            </div>
        </div>
    </template>

    <script>
        cnchar.use(window.cncharTrad);
        const HK_COMMON_CHARS = "‰∏Ä‰∫å‰∏âÂõõ‰∫îÂÖ≠‰∏ÉÂÖ´‰πùÂçÅÁôæÂçÉËê¨Êó•ÊúàÊ∞¥ÁÅ´Êú®ÈáëÂúü‰∫∫Âè£ÊâãË∂≥ËÄ≥ÁõÆÂøÉÂäõÂàÄÂºìÊààËô´Ë≤ùËªäËàüÈ¶¨ÁæäÁâõÈ≥•È≠öËÇâÈõ®È¢®Èõ≤ÈõªÁî∞Ë°£È£ü‰ΩèË°åÁà∂ÊØçÂÖÑÂºüÂßêÂ¶πÁî∑Â•≥ËÄÅÂ∞ëÂ§ßÂ∞èÈ´ò‰ΩéÈï∑Áü≠Â§öÂ∞ëÂâçÂæåÂ∑¶Âè≥ÂÖßÂ§ñ‰∏ä‰∏ãÊù±Ë•øÂçóÂåóÊò•Â§èÁßãÂÜ¨Êó©ÊôöÂçàÂ§úÂπ¥ÊúàÊó•ÊôÇÂàÜÁßí‰ªäÂ§©ÊòéÊò®ÊòüÊúüÂ≠∏Ê†°Â∏´ÁîüË™≤Êõ∏Á≠ÜÁ¥ôÁï´ÂúñÊñáÊï∏Â≠óË©ûÂè•Ë®ÄË™ûÂïèÁ≠îÁúãËÅΩË™™ËÆÄÂØ´ÂùêÁ´ãËµ∞Ë∑ëË∑≥ÂêÉÂñùÁù°Áé©Ê®ÇÂñúÊÄíÂìÄÊ®ÇÈÄôÈÇ£Ë™∞‰ªÄÈ∫ºË£°ÈÇäÂÆ∂ÂúãÂüéÂ∏ÇÊùëËçâËä±Ê®πÊûóÊûúËèúÁìúË±ÜÁ±≥È∫µÈ£ØËÇâËõãÂ•∂Ê≤πÈπΩÁ≥ñËå∂ÊùØÁõ§Á¢óÁ≠∑ÂàÄÂèâÂåôÊ°åÊ§ÖÂ∫äÁáàÈñÄÁ™óÁâÜÂú∞ÊàøÂ∫óËªäËàπÈ£õÊ©üÂÖ¨Â∑¥Â£´ÁöÑÂ£´Âú∞ÈêµÁ´ôË∑ØÊ©ãÊ±üÊ≤≥Êµ∑Ê¥ãÂ±±Ë∞∑Áü≥Ê≤ôÊ≥•ÂÖâÊöóÂÜ∑ÁÜ±Âø´ÊÖ¢Â•ΩÂ£ûÁúüÂÅáÂ∞çÈåØÁæéÈ∫ó‰πæÊ∑®Êï¥ÈΩäËÅ∞ÊòéÂã§ÂãûÂãáÊï¢ÂèãÊÑõÁ¶ÆË≤åÂÆàË¶èË™†ÂØ¶ÂÅ•Â∫∑Âø´Ê®ÇÂπ´ÂøôÂêà‰ΩúÂàÜ‰∫´ÈÅäÊà≤ÈÅãÂãïÂî±Ê≠åË∑≥ËàûÁï´Áï´Ë¨õÊïÖ‰∫ãÂÅöÂäüË™≤Ê¥óËáâÂà∑ÁâôÁ©øË°£ËÑ´ÈûãÊî∂ÊãæÊï¥ÁêÜÊ∏ÖÊΩîÊéÉÂú∞ÊäπÁ™óÊæÜÊ∞¥Á®ÆËä±È£ºÈ§äÂØµÁâ©ÁãóË≤ìÂÖîÈõûÈ¥®ÈµùË±¨ÁâõÁæäË∫´È´îÈ†≠È†∏ËÇ©ËÉåËÖ∞ËáÄËÖøËÖ≥ËÜùËìãÈ°èÈù¢ÁúºÁúâÈºªÂè£ÁâôËàåÂîáËÄ≥È´ÆÊåáÁî≤ÁöÆËÜöÈ°èËâ≤Á¥ÖÁôΩÈªÉÁ∂†ËóçÁ¥´ÈªëÁÅ∞Ê©ôÂï°Â§©Âú∞‰∫∫‰Ω†Êàë‰ªñÂ•πÂÆÉÂÄëÁà∏Â™ΩÂì•ÂßêÂºüÂ¶πÁà∫Â´≤ÂÖ¨Â©Ü‰ºØÂèîÂß®ËàÖÂÖíÂ≠´ÊúãÂèãÈÑ∞Â±ÖÂêåÂ≠∏ËÄÅÂ∏´Ê†°Èï∑ÈÜ´ÁîüË≠∑Â£´Ë≠¶ÂØüÈÉµÂ∑ÆÂè∏Ê©üÂ∫óÂì°ÂªöÂ∏´Ëæ≤Â§´ÊºÅÂ§´Â∑•‰∫∫ÊñáÂì°Ê≠åÊâãÁï´ÂÆ∂ÈÅãÂãïÂì°Â§™Á©∫‰∫∫ÊÑõÂ•ΩËààË∂£Âî±Ê≠åË∑≥ËàûÁï´Áï´ÁúãÊõ∏Ê∏∏Ê≥≥ÊâìÁêÉË∑ëÊ≠•Ë∏èÂñÆËªäÊóÖË°åÊîùÂΩ±ÁÉπÈ£™Á®ÆÊ§çÈ£ºÈ§äÊî∂ÈõÜÈÉµÁ•®Èå¢Âπ£Ê®°ÂûãÁé©ÂÖ∑ÈÅäÊà≤Ê©üÈõªËÖ¶ÈõªË¶ñÈõªÂΩ±Èü≥Ê®ÇÂç°ÈÄöÊïÖ‰∫ãÂ†±Á¥ôÈõúË™åÂ≠óÂÖ∏Âú∞ÂúñÂú∞ÁêÉÂÑÄÊñáÂÖ∑Êõ∏ÂåÖÁ≠ÜÁõíÈâõÁ≠ÜÂéüÂ≠êÁ≠ÜÊì¶ËÜ†Â∞∫Â≠êÂâ™ÂàÄËÜ†Ê∞¥ËÜ†Á¥ôÁï´Á≠ÜÈ°èÊñôÁï´Á¥ôÊâãÂ∑•Á¥ôÈ°èËâ≤Á¥ôÁö∫Á¥ôÁ∑¥ÁøíÁ∞øÊâãÂÜäË™≤Êú¨ÂúñÊõ∏ÂúñÊõ∏È§®Ë™≤ÂÆ§Á¶ÆÂ†ÇÊìçÂ†¥Â∞èÈ£üÈÉ®Ê¥óÊâãÈñìËæ¶ÂÖ¨ÂÆ§ÊïôÂì°ÂÆ§ÈÜ´ÁôÇÂÆ§Èü≥Ê®ÇÂÆ§Ë¶ñËóùÂÆ§ÈõªËÖ¶ÂÆ§Ê¥ªÂãïÂÆ§ÂúñÊõ∏ËßíÈñ±ËÆÄËßíÂ£ÅÂ†±ÊùøÂ†±ÂëäÊùøÂ£ÅÂ†±Ê°åÂ≠êÊ§ÖÂ≠êÈªëÊùøÁôΩÊùøÁ≤âÁ≠ÜÁôΩÊùøÁ≠ÜÊùøÊì¶Â∏ÉÊäπÂ∏ÉÊéÉÊääÂûÉÂúæÈèüÂûÉÂúæÊ°∂ÂõûÊî∂ÁÆ±Ëä±ÁõÜÊæÜÊ∞¥Â£∫È£ºÊñôÁ±†Â≠êÈ≠öÁº∏Ê∞¥ÊóèÁÆ±ÂÖ¨ÂúíÈÅäÊ®ÇÂ†¥ÊªëÊ¢ØÈû¶ÈüÜËπ∫Ëπ∫ÊùøÊîÄÁôªÊû∂Ê≤ôÊ±†ÂñÆËªäÂæëÁ∑©Ë∑ëÂæëÊ∂º‰∫≠Èï∑Ê§ÖËä±ÊßΩËçâÂú∞Ê®πÊú®Ëä±ÊúµÂ∞èËçâÊòÜËü≤Ëù¥Ëù∂ËúúËúÇËúªËúìËûûËüªËù∏ÁâõËöØËöìËúòËõõÁî≤Ëü≤ÈùíËõôËüæËúçÁÉèÈæúËú•Ëú¥Â£ÅËôéËõáÈ∫ªÈõÄÈ¥øÂ≠êÁáïÂ≠êËÄÅÈ∑πË≤ìÈ†≠È∑πÂïÑÊú®È≥•È∏öÈµ°‰ºÅÈµùÈ¥ïÈ≥•Â≠îÈõÄÂ§©ÈµùÈ¥®Â≠êÈµùÈõûÁÅ´ÈõûËùôËù†ÈØ®È≠öÊµ∑Ë±öÈØäÈ≠öÊµ∑È¶¨Êµ∑ÊòüËûÉËüπÈæçËù¶Ëù¶Â≠êÁ´†È≠öÈ≠∑È≠öÊ∞¥ÊØçÁèäÁëöË≤ùÊÆºÊµ∑Ëû∫ÁèçÁè†ÈáëÈ≠öÈØâÈ≠öÁÜ±Â∏∂È≠öÁçÖÂ≠êËÄÅËôéË±πÂ§ßË±°Èï∑È†∏ÈπøÊñëÈ¶¨ÁäÄÁâõÊ≤≥È¶¨È±∑È≠öÁÜäË≤ìÊ®πÁÜäË¢ãÈº†Áå¥Â≠êÁå©Áå©ÊùæÈº†ËÄÅÈº†ÂÖîÂ≠êÂà∫Áå¨ÁãêÁã∏ÁãºÈáéË±¨Èß±ÈßùÈ¶¨È©¢È®æÁæäÈπøË±¨ÁâõÁãóË≤ìÈº†ÂÄâÈº†Â§©Á´∫Èº†ÈæçÈ≥≥È∫íÈ∫üÊÄ™Áç∏ÊÅêÈæçÁ•û‰ªôÂ§©‰ΩøÈ≠îÈ¨ºÂ¶ñÊÄ™ÂπΩÈùàÊÆ≠Â±çÂê∏Ë°ÄÈ¨ºÂ∑´Â©ÜÂ∑®‰∫∫Â∞èÁüÆ‰∫∫Áæé‰∫∫È≠öÁôΩÈõ™ÂÖ¨‰∏ªÁÅ∞ÂßëÂ®òÁù°ÂÖ¨‰∏ªÂ∞èÁ¥ÖÂ∏Ω‰∏âÈöªÂ∞èË±¨ÈÜúÂ∞èÈ¥®ÈæúÂÖîË≥ΩË∑ëÁãº‰æÜ‰∫ÜË≥£ÁÅ´Êü¥ÁöÑÂ•≥Â≠©ÂúãÁéãÁéãÂêéÁéãÂ≠êÂÖ¨‰∏ªÂÆ∞Áõ∏Â∞áËªçÂ£´ÂÖµÂãáÂ£´Áçµ‰∫∫Ëæ≤Â§´Ê®µÂ§´ÊºÅÂ§´ÂïÜ‰∫∫Â∞èË≤©‰πû‰∏êÂº∑ÁõúÂ∞èÂÅ∑È®ôÂ≠êÂ£û‰∫∫Â•Ω‰∫∫Ëã±ÈõÑË∂Ö‰∫∫ÊÄ™Áç∏Â§ñÊòü‰∫∫Ê©üÂô®‰∫∫ÈõªËÖ¶ÊâãÊ©üÈõªË©±ÈõªË¶ñÊî∂Èü≥Ê©üÁõ∏Ê©üÈåÑÂΩ±Ê©üÂΩ±Âç∞Ê©üÂÇ≥ÁúüÊ©üÊâìÂç∞Ê©üÈçµÁõ§ÊªëÈº†Ëû¢ÂπïÁ°¨Á¢üÂÖâÁ¢üÈö®Ë∫´Á¢ü‰∫íËÅØÁ∂≤Á∂≤Á´ôÈõªÈÉµÁü≠Ë®äÊáâÁî®Á®ãÂºèÈÅäÊà≤Ëªü‰ª∂Á°¨‰ª∂ÈõªÊ±†ÈõªÁ∑öÊèíÈ†≠ÊèíÂ∫ßÈñãÈóúÊé£ÁáàÊ≥°ÂÖâÁÆ°ÈõªÁ≠íÂÖâÁ∫ñË°õÊòüÁÅ´ÁÆ≠È£õËàπÂ§™Á©∫Á´ôÂ§™Á©∫Ë°£ÊúõÈÅ†Èè°È°ØÂæÆÈè°ÊîæÂ§ßÈè°ÁúºÈè°Èö±ÂΩ¢ÁúºÈè°Â§™ÈôΩÁúºÈè°Âä©ËÅΩÂô®Ëº™Ê§ÖÊãêÊùñÁæ©ËÇ¢Ëó•Ê∞¥ËÜ†Â∏ÉÁπÉÂ∏∂Êé¢ÁÜ±ÈáùÂè£ÁΩ©Ê∂àÊØíËó•Ê∞¥Ê¥óÊâãÊ∂≤ËÇ•ÁöÇÊ≤êÊµ¥Èú≤Ê¥óÈ´ÆÊ∞¥ÁâôËÜèÁâôÂà∑ÊØõÂ∑æÊµ¥Â∑æÊâãÂ∏ïÁ¥ôÂ∑æÂªÅÁ¥ôÊøïÁ¥ôÂ∑æÂ∞øÁâáÂ•∂Á≤âÂ•∂Áì∂Â¨∞ÂÖíËªäÊêñÁ±ÉÂ∫äÂñÆË¢´ÂñÆÊûïÈ†≠ÊûïÈ†≠Â•óÊ£âË¢´ÊØõÊØØÂ∫äË§•Ë°£Ê´ÉÈûãÊ´ÉÊõ∏Ê´ÉÈõúÁâ©Êû∂ÂÑ≤Áâ©ÁÆ±Ë°£Êû∂Êõ¨Ë°£Â§æÊ¥óË°£Á±ÉÊ¥óË°£Ê©ü‰πæË°£Ê©üÁÜ®ÊñóÁÜ®Ë°£ÊùøÂê∏Â°µÊ©üÊéÉÂú∞Ê©üÂô®‰∫∫Á©∫Ê∞£Ê∏ÖÊñ∞Ê©üÊäΩÊøïÊ©üÂÜ∑Ê∞£Ê©üÈ¢®ÊâáÊöñÁàêÁÜ±Ê∞¥ÁàêÁÖÆÈ£üÁàêÂæÆÊ≥¢ÁàêÁÑóÁàêÂ§öÂ£´ÁàêÈõªÈ£ØÁÖ≤ÈõªÁÜ±Ê∞¥Â£∫Êî™ÊãåÊ©üÊ¶®Ê±ÅÊ©üÊ¥óÁ¢óÊ©üÈõ™Ê´ÉÂÜ∞Ê†ºÂûÉÂúæË¢ã‰øùÈÆÆÁ¥ôÈå´Á¥ôÂªöÊàøÁ¥ôÁôæÊΩîÂ∏ÉÊ¥óÊΩîÁ≤æÊéÉÊääÊãñÊääÊ∞¥Ê°∂Ê∞¥ÂñâÊ∞¥ÁÆ°Ëä±ÁÅëÊµ¥Áº∏Ê¥óÊâãÁõÜÈ¶¨Ê°∂Èè°Â≠êÊ¢≥Â≠êÈ¢®Á≠íÊåáÁî≤ÈâóÂåñÂ¶ùÂìÅÈ¶ôÊ∞¥È¶ñÈ£æÊâãÈå∂È†ÖÈçäÊâãÈçäËÄ≥Áí∞ÊàíÊåáÁúºÈè°È†òÂ∏∂ÁöÆÂ∏∂Èå¢ÂåÖÊâãË¢ãËÉåÂåÖÂÖ¨‰∫ãÂåÖÊóÖË°åÁÆ±Èõ®ÂÇòÈõ®Ë°£Èõ®Èù¥Â§™ÈôΩÂ∏ΩÂÜ∑Â∏ΩÊâãÂ•óÂúçÂ∑æÈ†∏Â∑æÂè£ÁΩ©Ê≥≥Ë°£Ê≥≥Ë§≤Ê≥≥Èè°Ê≥≥Â∏ΩÈÅãÂãïÊúçÈÅãÂãïÈûãÁöÆÈûãÊ∂ºÈûãÊãñÈûãÈ´òË∑üÈûãÈù¥Â≠êË•™Â≠êÂÖßË°£ÂÖßË§≤Áù°Ë°£Ê†°ÊúçÂà∂ÊúçË•øË£ùÁ¶ÆÊúçÂ©öÁ¥óÊóóË¢çÂíåÊúçÈüìÊúçÂîêË£ù‰∏≠Â±±Ë£ùÁâõ‰ªîË§≤Áü≠Ë§≤Èï∑Ë§≤Ë£ôÂ≠êÈÄ£Ë∫´Ë£ôÂ§ñÂ•óÂ§ßË°£ËÉåÂøÉÊØõË°£ÊÅ§Ë°´TÊÅ§";
        
        const state = { writers: {} };

        // üî• Âº∑Âà∂Â≠óÂÖ∏ (Fallback Dictionary)
        // Áï∂ API ÂàÜÊûêÂ§±ÊïóÊôÇÔºåÂÑ™ÂÖà‰ΩøÁî®ÈÄôË£°ÁöÑË≥áÊñô
        const MANUAL_POS = {
            'Â≠∏Ê†°': 'Âêç', 'ËÄÅÂ∏´': 'Âêç', 'Â≠∏Áîü': 'Âêç', 'ÂêåÂ≠∏': 'Âêç', 'Ë™≤Êú¨': 'Âêç', 'Êõ∏ÂåÖ': 'Âêç',
            'Ë∑ëÊ≠•': 'Âãï', 'Ê∏∏Ê≥≥': 'Âãï', 'Âî±Ê≠å': 'Âãï', 'Ë∑≥Ëàû': 'Âãï',
            'ÁæéÈ∫ó': 'ÂΩ¢', 'Âø´Ê®Ç': 'ÂΩ¢', '‰πæÊ∑®': 'ÂΩ¢', 'ËÅ∞Êòé': 'ÂΩ¢'
        };

        function toggleOverviewMode() {
            document.body.classList.toggle('overview-mode');
            const btn = document.getElementById('btn-overview');
            const isOverview = document.body.classList.contains('overview-mode');
            btn.innerText = isOverview ? "üëÅÔ∏è ÂÖ®Ë¶ΩÊ®°ÂºèÔºöÈñã" : "üëÅÔ∏è ÂÖ®Ë¶ΩÊ®°ÂºèÔºöÈóú";
            btn.classList.toggle('active-mode', isOverview);
        }

        async function generateCards() {
            const input = document.getElementById('input-text').value.trim();
            const container = document.getElementById('characters-container');
            const loading = document.getElementById('loading');

            if (!input) { alert("Ë´ãËº∏ÂÖ•ÊñáÂ≠ó"); return; }
            
            container.innerHTML = ''; 
            loading.style.display = 'block';
            state.writers = {}; 

            try {
                const segmenter = new Intl.Segmenter('zh-Hant-HK', { granularity: 'word' });
                const segments = [...segmenter.segment(input)];

                for (const segment of segments) {
                    const word = segment.segment;
                    if (!/[\u4e00-\u9fa5]/.test(word)) continue;

                    const card = createCardElement(word);
                    container.appendChild(card); 

                    const chars = word.split('');
                    for (const char of chars) {
                        setupCharacterVisuals(char, card);
                        setupCharacterInfo(char, card);
                    }
                    updateDefinition(word, card);
                    
                    // ÂïüÂãïË©ûÊÄßÂÅµÊ∏¨
                    fetchWordPOS(word, card);
                }
            } catch (err) {
                console.error(err);
                alert("ÁôºÁîüÈåØË™§");
            } finally {
                loading.style.display = 'none';
            }
        }

        function createCardElement(word) {
            const template = document.getElementById('card-template');
            const clone = template.content.cloneNode(true);
            clone.querySelector('.js-title').textContent = word;
            clone.querySelector('.js-btn-mandarin').onclick = () => speakText(word, 'zh-CN');
            clone.querySelector('.js-btn-cantonese').onclick = () => speakText(word, 'zh-HK');
            return clone.children[0];
        }

        function setupCharacterVisuals(char, cardElement) {
            const visualContainer = cardElement.querySelector('.js-visual-container');
            const template = document.getElementById('char-block-template');
            const clone = template.content.cloneNode(true);
            
            const uid = Math.random().toString(36).substr(2, 9);
            const demoId = `demo-${uid}`;
            const quizId = `quiz-${uid}`;
            const breakdownContainer = clone.querySelector('.js-breakdown-target');

            clone.querySelector('.js-demo-target').id = demoId;
            clone.querySelector('.js-quiz-target').id = quizId;

            const playBtn = clone.querySelector('.js-play-btn');
            const resetBtn = clone.querySelector('.js-reset-btn');
            const statusText = clone.querySelector('.js-status-text');

            visualContainer.appendChild(clone);

            const width = window.innerWidth > 768 ? 260 : 160;

            const demo = HanziWriter.create(demoId, char, { width: width, height: width, padding: 5, showOutline: true, strokeAnimationSpeed: 1, delayBetweenStrokes: 200, strokeColor: '#555' });
            const quiz = HanziWriter.create(quizId, char, { width: width, height: width, padding: 5, showOutline: true, strokeColor: '#333', highlightColor: '#4CAF50', drawingWidth: 20, showHintAfterMisses: 2 });
            state.writers[uid] = { demo, quiz, status: statusText };

            startQuizLoop(uid);
            playBtn.onclick = () => demo.animateCharacter();
            resetBtn.onclick = () => resetQuiz(uid);

            setTimeout(() => generateBreakdown(char, breakdownContainer, false), 500);
        }

        async function generateBreakdown(char, container, isPrint) {
            if(!isPrint) container.innerHTML = '<span style="font-size:12px; color:#999;">ËÆÄÂèñ‰∏≠...</span>';

            try {
                const url = `https://cdn.jsdelivr.net/npm/hanzi-writer-data@2.0/${encodeURIComponent(char)}.json`;
                const res = await fetch(url);
                if (!res.ok) throw new Error("Network Error");
                const charData = await res.json();

                if(!isPrint) container.innerHTML = ''; 
                const total = charData.strokes.length; 
                const strokes = charData.strokes;      

                for (let i = 0; i < total; i++) {
                    const box = document.createElement('div');
                    box.className = isPrint ? 'print-step-box' : (i === total - 1 ? 'step-box is-last' : 'step-box');
                    if(!isPrint) {
                        const num = document.createElement('span');
                        num.className = 'step-number';
                        num.innerText = i + 1;
                        box.appendChild(num);
                    }
                    container.appendChild(box);

                    const svgNS = "http://www.w3.org/2000/svg";
                    const svg = document.createElementNS(svgNS, "svg");
                    svg.setAttribute("viewBox", "0 0 1024 1024");
                    
                    const g = document.createElementNS(svgNS, "g");
                    g.setAttribute("transform", "scale(1, -1) translate(0, -900)");

                    for(let j = 0; j <= i; j++) {
                        const path = document.createElementNS(svgNS, "path");
                        path.setAttribute("d", strokes[j]);
                        if (j === i) {
                            path.setAttribute("fill", "#d84315"); 
                        } else {
                            path.setAttribute("fill", "#555");
                        }
                        g.appendChild(path);
                    }
                    svg.appendChild(g);
                    box.appendChild(svg);
                }

            } catch(e) { 
                console.error(e);
                container.innerHTML = `<span style="font-size:12px; color:red;">‚ùå ÈåØË™§: ${e.message}</span>`; 
            }
        }

        function setupCharacterInfo(char, cardElement) {
            const infoContainer = cardElement.querySelector('.js-info-container');
            const pinyin = cnchar.spell(char, 'tone');
            let radical = 'ÁÑ°';
            try { radical = cnchar.radical(char)[0].radical; } catch {}

            const div = document.createElement('div');
            div.className = 'info-item';
            div.innerHTML = `
                <div style="display:flex; align-items:center; gap:15px; margin-bottom:10px;">
                    <div class="info-big-char">${char}</div>
                    <div style="text-align:left; width:100%;">
                        <div class="info-row">ÊãºÈü≥Ôºö${pinyin}</div>
                        <div class="info-row">
                            ÈÉ®È¶ñÔºö<span onclick="openRadicalModal('${radical}')" class="info-radical-link">${radical}</span>
                        </div>
                        <div class="pos-container"></div>
                    </div>
                </div>
            `;
            infoContainer.appendChild(div);
            fetchPOS(char, div.querySelector('.pos-container'));
        }

        async function fetchPOS(char, container) {
            try {
                const res = await fetch(`https://www.moedict.tw/uni/${encodeURIComponent(char)}.json`);
                if(!res.ok) return;
                const data = await res.json();
                
                const types = new Set();
                if(data.heteronyms) {
                    data.heteronyms.forEach(h => {
                        if(h.definitions) {
                            h.definitions.forEach(d => {
                                if(d.type) types.add(d.type.replace('Ë©û','')); 
                            });
                        }
                    });
                }
                if(types.size > 0) {
                    types.forEach(type => {
                        const tag = document.createElement('span');
                        tag.className = 'pos-tag';
                        tag.innerText = type;
                        if(type.includes('Âêç')) tag.classList.add('noun');
                        else if(type.includes('Âãï')) tag.classList.add('verb');
                        else if(type.includes('ÂΩ¢') || type.includes('ÂâØ')) tag.classList.add('adj');
                        container.appendChild(tag);
                    });
                }
            } catch(e) {}
        }

        // --- üî• ÊúÄÁµÇ‰øÆÊ≠£ÔºöË©ûË™ûÁ¥öË©ûÊÄßÊü•Ë©¢ (Âº∑Âà∂Â≠óÂÖ∏ + Ë™ûÊÑèÂàÜÊûê) ---
        async function fetchWordPOS(word, cardElement) {
            const container = cardElement.querySelector('.js-word-pos');
            const types = new Set();

            // 1. Á¨¨‰∏ÄÈóúÔºöÊü•Âº∑Âà∂Â≠óÂÖ∏ (ÊúÄÊ∫ñÁ¢∫)
            if (MANUAL_POS[word]) {
                types.add(MANUAL_POS[word]);
            }

            // 2. Á¨¨‰∫åÈóúÔºöÂ¶ÇÊûúÊ≤íÊü•Âà∞ÔºåÂÜçÂïè API
            if (types.size === 0) {
                try {
                    const res = await fetch(`https://www.moedict.tw/a/${encodeURIComponent(word)}.json`);
                    if(res.ok) {
                        const data = await res.json();
                        // Ë™ûÊÑèÂàÜÊûê
                        const fullText = JSON.stringify(data);
                        if(fullText.includes('ÁöÑÂú∞Êñπ') || 
                           fullText.includes('ÁöÑÊ©üÊßã') || 
                           fullText.includes('ÁöÑÁ∏ΩÁ®±') ||
                           fullText.includes('ÂêçÁ®±')) {
                            types.add('Âêç');
                        }
                        if(fullText.includes('ÂΩ¢ÂÆπ') || fullText.includes('ÁöÑÊ®£Â≠ê')) {
                            types.add('ÂΩ¢');
                        }
                        // ÂÆòÊñπÊ¨Ñ‰Ωç
                        if(data.h) {
                            data.h.forEach(h => {
                                if(h.d) {
                                    h.d.forEach(d => {
                                        if(d.type) types.add(d.type.replace('Ë©û',''));
                                    });
                                }
                            });
                        }
                    }
                } catch(e) {}
            }

            // 3. Ê∏≤Êüì
            container.innerHTML = '';
            if(types.size > 0) {
                types.forEach(type => {
                    const tag = document.createElement('span');
                    tag.className = 'word-pos-tag'; 
                    tag.innerText = type;
                    if(type.includes('Âêç')) tag.classList.add('noun');
                    else if(type.includes('Âãï')) tag.classList.add('verb');
                    else if(type.includes('ÂΩ¢')) tag.classList.add('adj');
                    container.appendChild(tag);
                });
            }
        }

        function startQuizLoop(uid) {
            const w = state.writers[uid];
            w.status.innerText = "Ë´ãÂØ´Â≠ó"; w.status.style.color = "#d84315";
            w.quiz.quiz({
                onMistake: () => { w.status.innerText = "‚ùå"; },
                onCorrectStroke: () => { w.status.innerText = "‚úÖ"; },
                onComplete: () => { w.status.innerText = "üéâ ÂÆåÁæé"; }
            });
        }
        function resetQuiz(uid) { startQuizLoop(uid); }

        function openRadicalModal(radical) {
            if(!radical || radical === 'ÁÑ°') return;
            document.getElementById('modal-radical-title').innerText = radical;
            const grid = document.getElementById('modal-grid');
            grid.innerHTML = '';
            
            const matches = HK_COMMON_CHARS.split('').filter(c => {
                try { return cnchar.radical(c)[0].radical === radical; } catch { return false; }
            });
            const uniqueMatches = [...new Set(matches)];

            uniqueMatches.slice(0, 32).forEach(c => {
                const btn = document.createElement('div');
                btn.className = 'radical-char-btn';
                btn.innerText = c;
                btn.onclick = () => { document.getElementById('input-text').value += c; closeRadicalModal(null, true); };
                grid.appendChild(btn);
            });
            document.getElementById('radical-modal').classList.add('open');
        }
        function closeRadicalModal(e, force) {
            if (force || e.target.id === 'radical-modal') document.getElementById('radical-modal').classList.remove('open');
        }

        async function autoPrint() {
            const input = document.getElementById('input-text').value.trim();
            if (!input) { alert("Ë´ãÂÖàËº∏ÂÖ•ÊñáÂ≠ó"); return; }
            
            const printContent = document.getElementById('print-content');
            printContent.innerHTML = ''; 
            
            const segmenter = new Intl.Segmenter('zh-Hant-HK', { granularity: 'word' });
            const segments = [...segmenter.segment(input)];
            
            for (const seg of segments) {
                const word = seg.segment;
                if (!/[\u4e00-\u9fa5]/.test(word)) continue;

                const row = document.createElement('div');
                row.className = 'print-row';
                
                const mainLine = document.createElement('div');
                mainLine.className = 'print-main-line';
                
                const infoCol = document.createElement('div');
                infoCol.className = 'print-info-col';
                
                const gridContainer = document.createElement('div');
                gridContainer.className = 'print-grid-container';
                gridContainer.innerHTML = '<div class="print-grid-box"></div>'.repeat(8);

                const chars = word.split('');
                for (let i = 0; i < chars.length; i++) {
                    const char = chars[i];
                    const uid = Math.random().toString(36).substr(2, 9);
                    
                    const charBlock = document.createElement('div');
                    charBlock.className = 'print-char-block';
                    charBlock.innerHTML = `
                        <div class="print-char-big" id="p-big-${uid}"></div>
                    `;
                    infoCol.appendChild(charBlock);
                    
                    setTimeout(() => {
                        HanziWriter.create(`p-big-${uid}`, char, { 
                            width: 60, height: 60, showOutline: true, strokeColor: '#000' 
                        });
                    }, 100);
                }
                
                mainLine.appendChild(infoCol);
                mainLine.appendChild(gridContainer);
                row.appendChild(mainLine);

                const breakdownArea = document.createElement('div');
                breakdownArea.className = 'print-breakdown-area';
                
                for (const char of chars) {
                    const breakdownRow = document.createElement('div');
                    breakdownRow.className = 'print-breakdown-row';
                    
                    const label = document.createElement('div');
                    label.className = 'print-label';
                    label.innerText = char + "Ôºö";
                    breakdownRow.appendChild(label);
                    
                    const breakdownImgs = document.createElement('div');
                    breakdownImgs.className = 'print-breakdown-imgs';
                    breakdownRow.appendChild(breakdownImgs);
                    
                    breakdownArea.appendChild(breakdownRow);

                    await generateBreakdown(char, breakdownImgs, true);
                }
                
                row.appendChild(breakdownArea);
                printContent.appendChild(row);
            }

            setTimeout(() => { window.print(); }, 1500);
        }

        function speakText(text, lang) {
            window.speechSynthesis.cancel();
            const u = new SpeechSynthesisUtterance(text);
            u.lang = lang; window.speechSynthesis.speak(u);
        }
        
        async function updateDefinition(word, cardElement) {
            const defEl = cardElement.querySelector('.js-def-text');
            try {
                const res = await fetch(`https://www.moedict.tw/a/${encodeURIComponent(word)}.json`);
                if(res.ok) {
                    const data = await res.json();
                    let defs = [];
                    if(data.h) data.h.forEach(h => { if(h.d) h.d.forEach(d => { if(d.f) defs.push(d.f.replace(/[~`\[\]]/g,"")); })});
                    
                    defEl.textContent = defs.length ? defs.map((d,i)=>`${i+1}. ${d}`).join('\n') : "ÁÑ°Ë©≥Á¥∞Ëß£Èáã";
                } else { defEl.textContent = "Êü•ÁÑ°Ë≥áÊñô"; }
            } catch { defEl.textContent = "ÁÑ°Ë≥áÊñô"; }
        }
    </script>
</body>
</html>
